---
services:
  documents:
    build:
      context: ./services/documents
      dockerfile: Dockerfile
    environment:
      - DEBUG=True
      - MONGO_URL=mongodb://root:secret@mongo:27017/
      - FILES_URL=http://files:8080/
      - AMQP_URL=amqp://guest:guest@rabbitmq:5672/
      - GOVCARPETA_URL=http://govcarpeta:8080/
      - AMQP_EXCHANGE=documents
      - AMQP_ROUTING_KEY=documents
    volumes:
      - ./services/documents:/app
    ports:
      - 8080:8080
    command: ["python3", "src/main/documents.py"]
    networks:
      - app-network

  # update_citizen_to_documents_worker:
  #   build:
  #     context: ../../services/documents
  #     dockerfile: Dockerfile
  #   environment:
  #     - DEBUG=True
  #   volumes:
  #     - ../../services/documents:/app
  #   command: ["python3", "src/main/update_citizen_to_documents_worker.py"]
  #   networks:
  #     - app-network

  mongo:
    image: mongo
    environment:
      MONGO_INITDB_ROOT_USERNAME: root
      MONGO_INITDB_ROOT_PASSWORD: secret
    networks:
      - app-network

  # rabbitmq:
  #   image: rabbitmq:3.8-management-alpine
  #   expose:
  #     - 5672
  #   ports:
  #     - 15672:15672
  #   volumes:
  #     - ../rabbitmq/config/rabbitmq-definitions.json:/etc/rabbitmq/definitions.json
  #   networks:
  #     - app-network

  files:
    build:
      context: ./services/files
      dockerfile: Dockerfile
    environment:
      - DEBUG=True
      - AWS_SERVER_BUCKET=abc
      - AWS_SERVER_ACCESS_KEY_ID=abc
      - AWS_SERVER_SECRET_KEY=abc
    volumes:
      - ./services/files:/app
    command: ["python3", "src/main/files.py"]
    networks:
      - app-network

networks:
  app-network:
